import{K as q,A as F,a2 as _,u as G,r as l,af as w,j as e,ag as A,ah as Q,W as H,ai as W,aj as K}from"./index-BEi8WKuF.js";import{L as E}from"./Layout-Dj9Dgcds.js";function J(n){return q({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M10 18a7.952 7.952 0 0 0 4.897-1.688l4.396 4.396 1.414-1.414-4.396-4.396A7.952 7.952 0 0 0 18 10c0-4.411-3.589-8-8-8s-8 3.589-8 8 3.589 8 8 8zm0-14c3.309 0 6 2.691 6 6s-2.691 6-6 6-6-2.691-6-6 2.691-6 6-6z"},child:[]}]})(n)}const L="/orders",X=async(n=1,d=10)=>{try{console.log(`Récupération des commandes - page: ${n}, limit: ${d}`);const a=localStorage.getItem("distritherm_access_token");if(!a)throw console.error("Authentification manquante: token absent"),new Error("Vous devez être connecté pour accéder à vos commandes");console.log("Envoi de la requête API avec authentification");const m=await F.get(`${L}?page=${n}&limit=${d}`,{headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:`Bearer ${a}`}});return console.log("Réponse API commandes:",m.data),m.data}catch(a){throw console.error("Erreur getAllOrders:",a),a.response?console.error("Réponse d'erreur:",{status:a.response.status,data:a.response.data,headers:a.response.headers}):a.request?console.error("Erreur de requête (pas de réponse):",a.request):console.error("Erreur de configuration:",a.message),R(a)}},Y=async n=>{try{return(await F.get(`${L}/${n}`,{headers:{"Content-Type":"application/json",Accept:"application/json"}})).data}catch(d){throw R(d)}},R=n=>{if(console.error("Détails de l'erreur API:",n),n.response){const d=n.response.data;return new Error(d.message||"Une erreur est survenue lors de la communication avec le serveur")}return new Error("Impossible de se connecter au serveur")},te=()=>{const{isAuthenticated:n,user:d}=_(),a=G(),[m,I]=l.useState([]),[U,x]=l.useState(!0),[S,f]=l.useState(""),[r,y]=l.useState(null),[j,$]=l.useState(""),[p,z]=l.useState("all"),[c,C]=l.useState(1),[u,M]=l.useState(1),[P,Z]=l.useState(5),[O,V]=l.useState({total:0,page:1,limit:5,lastPage:1});l.useEffect(()=>{n||a("/connexion")},[n,a]);const k=l.useCallback(async(s,i)=>{if(!n){console.error("Utilisateur non authentifié - Redirection vers la page de connexion"),w.error("Vous devez être connecté pour accéder à vos commandes"),a("/connexion");return}try{console.log(`Chargement des commandes - page ${s}, limit ${i}`),x(!0),f("");const t=await X(s,i);if(console.log("Réponse API des commandes:",t),!t||!t.orders)throw new Error("Format de réponse incorrect");const o=t.orders.map(h=>({id:h.id,orderNumber:`CMD-${String(h.id).padStart(3,"0")}`,date:h.createdAt,status:h.status,totalAmount:0,items:[],shippingAddress:{fullName:"Adresse de livraison",streetAddress:"Détails non disponibles",city:"",postalCode:"",country:"France"},billingAddress:{fullName:"Adresse de facturation",streetAddress:"Détails non disponibles",city:"",postalCode:"",country:"France"},factureFileUrl:h.factureFileUrl}));I(o);const g={total:t.meta.total,page:t.meta.page,limit:t.meta.limit,lastPage:t.meta.lastPage};console.log("Métadonnées de pagination:",g),V(g),M(g.lastPage),C(g.page),x(!1)}catch(t){console.error("Erreur de chargement des commandes:",t);let o="Une erreur est survenue lors du chargement des commandes";t.message==="Vous devez être connecté pour accéder à vos commandes"?(o="Session expirée. Veuillez vous reconnecter.",setTimeout(()=>{a("/connexion")},1500)):t.response&&t.response.status===401?o="Vous n'êtes pas autorisé à accéder à ces informations":t.response&&t.response.status===403?o="Accès refusé à cette ressource":t.response&&t.response.status===404?o="Aucune commande trouvée":navigator.onLine||(o="Vous êtes hors ligne. Vérifiez votre connexion internet."),f(o),w.error(o),x(!1)}},[n,a]);l.useEffect(()=>{n&&k(c,P)},[n,c,P,k]);const B=async s=>{try{x(!0);const t=(await Y(s)).order,o={id:t.id,orderNumber:`CMD-${String(t.id).padStart(3,"0")}`,date:t.createdAt,status:t.status,totalAmount:0,items:[],shippingAddress:{fullName:"Adresse de livraison",streetAddress:"Détails non disponibles",city:"",postalCode:"",country:"France"},billingAddress:{fullName:"Adresse de facturation",streetAddress:"Détails non disponibles",city:"",postalCode:"",country:"France"},factureFileUrl:t.factureFileUrl};y(o),x(!1)}catch(i){f(i.message||"Une erreur est survenue lors du chargement des détails de la commande"),w.error("Impossible de charger les détails de la commande"),x(!1)}},D=s=>new Date(s).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),N=s=>({PENDING:{color:"bg-yellow-500",label:"En attente"},PROCESSING:{color:"bg-blue-500",label:"En traitement"},SHIPPED:{color:"bg-indigo-500",label:"Expédiée"},DELIVERED:{color:"bg-green-500",label:"Livrée"},CANCELLED:{color:"bg-red-500",label:"Annulée"}})[s]||{color:"bg-gray-500",label:"Statut inconnu"},T=s=>{B(s.id)},b=m.filter(s=>{const i=s.orderNumber.toLowerCase().includes(j.toLowerCase()),t=p==="all"||s.status===p;return i&&t}),v=l.useCallback(s=>{console.log(`Changement de page: ${s}`),s!==c&&C(s)},[c]);return U&&m.length===0?e.jsx(E,{children:e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-teal-500"})})})}):S&&m.length===0?e.jsx(E,{children:e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative",role:"alert",children:[e.jsx("strong",{className:"font-bold",children:"Erreur !"}),e.jsxs("span",{className:"block sm:inline",children:[" ",S]})]})})}):e.jsx(E,{children:e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:"Mes Commandes"}),e.jsx("div",{className:"bg-white rounded-lg shadow-md p-4 mb-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(J,{className:"text-gray-400"})}),e.jsx("input",{type:"text",className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-teal-500 sm:text-sm",placeholder:"Rechercher une commande...",value:j,onChange:s=>$(s.target.value)})]}),e.jsx("div",{className:"flex flex-col sm:flex-row gap-2",children:e.jsxs("select",{className:"block w-full sm:w-auto pl-3 pr-10 py-2 text-base border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-teal-500 sm:text-sm",value:p,onChange:s=>z(s.target.value),children:[e.jsx("option",{value:"all",children:"Tous les statuts"}),e.jsx("option",{value:"PENDING",children:"En attente"}),e.jsx("option",{value:"PROCESSING",children:"En traitement"}),e.jsx("option",{value:"SHIPPED",children:"Expédiée"}),e.jsx("option",{value:"DELIVERED",children:"Livrée"}),e.jsx("option",{value:"CANCELLED",children:"Annulée"})]})})]})}),b.length===0?e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-8 text-center",children:[e.jsx("div",{className:"text-5xl text-gray-300 mb-4",children:e.jsx(A,{className:"mx-auto"})}),e.jsx("h3",{className:"text-xl font-medium text-gray-700 mb-2",children:"Aucune commande trouvée"}),e.jsx("p",{className:"text-gray-500",children:j||p!=="all"?"Aucune commande ne correspond à vos critères de recherche.":"Vous n'avez pas encore passé de commande."})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-white rounded-lg shadow-md overflow-hidden mb-6",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Commande"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Statut"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Facture"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:b.map(s=>{const{color:i,label:t}=N(s.status);return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:s.orderNumber})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-500",children:D(s.date)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${i} text-white`,children:t})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:s.factureFileUrl?e.jsxs("a",{href:s.factureFileUrl,target:"_blank",rel:"noopener noreferrer",className:"text-teal-600 hover:text-teal-800 flex items-center justify-end",children:[e.jsx(Q,{className:"mr-1"}),"Facture"]}):e.jsx("span",{className:"text-gray-400",children:"Non disponible"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.jsxs("button",{onClick:()=>T(s),className:"text-teal-600 hover:text-teal-800 flex items-center justify-end",children:[e.jsx(H,{className:"mr-1"}),"Détails"]})})]},s.id)})})]})})}),e.jsx("div",{className:"flex items-center justify-between border-t border-gray-200 bg-white px-4 py-3 sm:px-6 rounded-lg shadow-md",children:e.jsxs("div",{className:"hidden sm:flex sm:flex-1 sm:items-center sm:justify-between",children:[e.jsx("div",{children:e.jsxs("p",{className:"text-sm text-gray-700",children:["Affichage de ",e.jsx("span",{className:"font-medium",children:b.length})," commande(s) sur ",e.jsx("span",{className:"font-medium",children:O.total})]})}),e.jsx("div",{children:e.jsxs("nav",{className:"isolate inline-flex -space-x-px rounded-md shadow-sm","aria-label":"Pagination",children:[e.jsxs("button",{onClick:()=>v(Math.max(1,c-1)),disabled:c===1,className:`relative inline-flex items-center rounded-l-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0 ${c===1?"opacity-50 cursor-not-allowed":""}`,children:[e.jsx("span",{className:"sr-only",children:"Précédent"}),e.jsx("svg",{className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true",children:e.jsx("path",{fillRule:"evenodd",d:"M12.79 5.23a.75.75 0 01-.02 1.06L8.832 10l3.938 3.71a.75.75 0 11-1.04 1.08l-4.5-4.25a.75.75 0 010-1.08l4.5-4.25a.75.75 0 011.06.02z",clipRule:"evenodd"})})]}),Array.from({length:u},(s,i)=>i+1).map(s=>e.jsx("button",{onClick:()=>v(s),className:`relative inline-flex items-center px-4 py-2 text-sm font-semibold ${s===c?"z-10 bg-teal-600 text-white focus:z-20 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-teal-600":"text-gray-900 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0"}`,children:s},s)),e.jsxs("button",{onClick:()=>v(Math.min(u,c+1)),disabled:c===u||u===0,className:`relative inline-flex items-center rounded-r-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0 ${c===u||u===0?"opacity-50 cursor-not-allowed":""}`,children:[e.jsx("span",{className:"sr-only",children:"Suivant"}),e.jsx("svg",{className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true",children:e.jsx("path",{fillRule:"evenodd",d:"M7.21 14.77a.75.75 0 01.02-1.06L11.168 10 7.23 6.29a.75.75 0 111.04-1.08l4.5 4.25a.75.75 0 010 1.08l-4.5 4.25a.75.75 0 01-1.06-.02z",clipRule:"evenodd"})})]})]})})]})})]}),r&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Détails de la commande"}),e.jsx("button",{onClick:()=>y(null),className:"text-gray-500 hover:text-gray-700",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold mb-2 flex items-center",children:[e.jsx(A,{className:"mr-2 text-teal-600"}),"Informations de commande"]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Numéro de commande:"}),e.jsx("span",{className:"ml-2",children:r.orderNumber})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Date:"}),e.jsx("span",{className:"ml-2",children:D(r.date)})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Statut:"}),e.jsx("span",{className:"ml-2",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${N(r.status).color} text-white`,children:N(r.status).label})})]}),r.factureFileUrl&&e.jsx("div",{className:"mt-4",children:e.jsxs("a",{href:r.factureFileUrl,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-teal-600 hover:bg-teal-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-teal-500",children:[e.jsx(W,{className:"mr-2"}),"Télécharger la facture"]})})]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold mb-2 flex items-center",children:[e.jsx(K,{className:"mr-2 text-teal-600"}),"Adresses"]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"font-medium text-gray-700 mb-1",children:"Adresse de livraison:"}),e.jsx("p",{className:"text-sm text-gray-600",children:r.shippingAddress.fullName}),e.jsx("p",{className:"text-sm text-gray-600",children:r.shippingAddress.streetAddress}),e.jsxs("p",{className:"text-sm text-gray-600",children:[r.shippingAddress.postalCode," ",r.shippingAddress.city,", ",r.shippingAddress.country]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-700 mb-1",children:"Adresse de facturation:"}),e.jsx("p",{className:"text-sm text-gray-600",children:r.billingAddress.fullName}),e.jsx("p",{className:"text-sm text-gray-600",children:r.billingAddress.streetAddress}),e.jsxs("p",{className:"text-sm text-gray-600",children:[r.billingAddress.postalCode," ",r.billingAddress.city,", ",r.billingAddress.country]})]})]})]})]}),e.jsxs("h3",{className:"text-lg font-semibold mb-3 flex items-center",children:[e.jsx(A,{className:"mr-2 text-teal-600"}),"Produits commandés"]}),r.items.length===0?e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg text-center",children:e.jsx("p",{className:"text-gray-500",children:"Détails des produits non disponibles"})}):e.jsx("div",{className:"bg-white border border-gray-200 rounded-lg overflow-hidden",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Produit"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Prix unitaire"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Quantité"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:r.items.map(s=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[s.imageUrl&&e.jsx("div",{className:"flex-shrink-0 h-10 w-10 mr-3",children:e.jsx("img",{className:"h-10 w-10 rounded-md object-cover",src:s.imageUrl,alt:s.productName})}),e.jsx("div",{className:"text-sm font-medium text-gray-900",children:s.productName})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm text-gray-500",children:s.unitPrice.toLocaleString("fr-FR",{style:"currency",currency:"EUR"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm text-gray-500",children:s.quantity}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:(s.unitPrice*s.quantity).toLocaleString("fr-FR",{style:"currency",currency:"EUR"})})]},s.id))}),e.jsx("tfoot",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:3,className:"px-6 py-4 text-right text-sm font-medium text-gray-900",children:"Total"}),e.jsx("td",{className:"px-6 py-4 text-right text-sm font-bold text-gray-900",children:r.totalAmount.toLocaleString("fr-FR",{style:"currency",currency:"EUR"})})]})})]})}),e.jsx("div",{className:"mt-6 flex justify-end",children:e.jsx("button",{onClick:()=>y(null),className:"px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition-colors duration-200",children:"Fermer"})})]})})})]})})};export{te as default};
