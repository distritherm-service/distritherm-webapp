import{D as k,a5 as z,r,j as e,B as P,a4 as V,a6 as I,a7 as F,a8 as A,A as U,z as T,a9 as M,aa as H}from"./index-CoitgkXy.js";import{L as K}from"./Layout-YRXkjHDi.js";import"./Breadcrumb-EE0GQRr3.js";const Q=({inCart:v=!1,onSwitchForm:N,onShowForgotPassword:j,onGoogleSuccess:b,onGoogleError:i})=>{const m=k(),{login:h}=z(),[u,a]=r.useState(!1),[n,t]=r.useState(""),[x,s]=r.useState({email:"",password:""}),g=c=>{const{name:l,value:p}=c.target;s({...x,[l]:p})},f=async c=>{var l,p,o,d;c.preventDefault(),t("");try{a(!0);const y=await F.login(x);h(y),setTimeout(v?()=>{m("/panier/delivery")}:()=>{m("/")},2e3)}catch(y){console.error("Erreur de connexion:",y),((l=y.response)==null?void 0:l.status)===401?t("Email ou mot de passe incorrect."):((p=y.response)==null?void 0:p.status)===400?t("Veuillez vérifier vos informations de connexion."):t(((d=(o=y.response)==null?void 0:o.data)==null?void 0:d.message)||"Une erreur est survenue lors de la connexion.")}finally{a(!1)}};return e.jsxs("form",{onSubmit:f,className:"space-y-4",children:[n&&e.jsx("div",{className:"p-3 bg-red-100 border border-red-200 rounded-md text-red-600 text-sm",children:n}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Adresse email",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(P,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"email",name:"email",className:"w-full pl-10 px-4 py-3 rounded-lg border border-gray-200 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent",placeholder:"votreemail@exemple.com",value:x.email,onChange:g,required:!0})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Mot de passe",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(V,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"password",name:"password",className:"w-full pl-10 px-4 py-3 rounded-lg border border-gray-200 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent",placeholder:"********",value:x.password,onChange:g,required:!0})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{type:"button",onClick:j,className:"text-sm text-teal-600 hover:underline",children:"Mot de passe oublié ?"})}),e.jsx("div",{className:"mt-6",children:e.jsx("button",{type:"submit",className:"w-full px-4 py-3 bg-gradient-to-r from-teal-600 to-blue-600 text-white rounded-lg hover:from-teal-700 hover:to-blue-700",disabled:u,children:u?"Chargement...":"Se connecter"})}),e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-gray-200"})}),e.jsx("div",{className:"relative flex justify-center text-sm",children:e.jsx("span",{className:"px-2 bg-white text-gray-500",children:"Ou"})})]}),e.jsx("div",{className:"mt-6",children:e.jsx(I,{width:"100%",size:"large",text:"continue_with",shape:"rectangular",onSuccess:b,onError:i})})]}),e.jsx("div",{className:"mt-4 text-center",children:e.jsxs("p",{className:"text-sm text-gray-600",children:["Vous n'avez pas de compte ?"," ",e.jsx("button",{type:"button",onClick:N,className:"text-teal-600 hover:underline font-medium",children:"Créer un compte"})]})})]})},Y=({inCart:v=!1,onSwitchForm:N,onGoogleSuccess:j,onGoogleError:b})=>{const i=k(),{login:m}=z(),[h,u]=r.useState(!1),[a,n]=r.useState(""),[t,x]=r.useState({firstName:"",lastName:"",email:"",password:"",companyName:"",siretNumber:"",phoneNumber:""}),s=f=>{const{name:c,value:l}=f.target;x({...t,[c]:l})},g=async f=>{var c,l,p,o,d,y,C;f.preventDefault(),n("");try{u(!0),console.log("Données d'inscription à envoyer:",t);const w=await F.register(t);m(w),v?setTimeout(()=>{i("/panier/delivery")},2e3):setTimeout(()=>{i("/inscription-reussie")},1e3)}catch(w){console.error("Erreur d'inscription:",w),((c=w.response)==null?void 0:c.status)===409?n("Un utilisateur avec cette adresse email existe déjà."):((l=w.response)==null?void 0:l.status)===400?(d=(o=(p=w.response)==null?void 0:p.data)==null?void 0:o.message)!=null&&d.includes("téléphone")?n("Le format du numéro de téléphone n'est pas valide. Utilisez le format +33XXXXXXXXX."):n("Veuillez vérifier vos informations d'inscription."):n(((C=(y=w.response)==null?void 0:y.data)==null?void 0:C.message)||"Une erreur est survenue lors de l'inscription.")}finally{u(!1)}};return e.jsxs("form",{onSubmit:g,className:"space-y-4",children:[a&&e.jsx("div",{className:"p-3 bg-red-100 border border-red-200 rounded-md text-red-600 text-sm",children:a}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Prénom",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(A,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"text",name:"firstName",className:"w-full pl-10 px-4 py-3 rounded-lg border border-gray-200 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent",placeholder:"Jean",value:t.firstName,onChange:s,required:!0})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Nom",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(A,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"text",name:"lastName",className:"w-full pl-10 px-4 py-3 rounded-lg border border-gray-200 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent",placeholder:"Dupont",value:t.lastName,onChange:s,required:!0})]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Adresse email",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(P,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"email",name:"email",className:"w-full pl-10 px-4 py-3 rounded-lg border border-gray-200 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent",placeholder:"votreemail@exemple.com",value:t.email,onChange:s,required:!0})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Mot de passe",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(V,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"password",name:"password",className:"w-full pl-10 px-4 py-3 rounded-lg border border-gray-200 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent",placeholder:"********",value:t.password,onChange:s,required:!0,minLength:8})]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Le mot de passe doit contenir au moins 8 caractères."})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Téléphone",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(U,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"tel",name:"phoneNumber",className:"w-full pl-10 px-4 py-3 rounded-lg border border-gray-200 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent",placeholder:"06 12 34 56 78",value:t.phoneNumber,onChange:s,required:!0})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Nom de l'entreprise",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(T,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"text",name:"companyName",className:"w-full pl-10 px-4 py-3 rounded-lg border border-gray-200 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent",placeholder:"Votre entreprise",value:t.companyName,onChange:s,required:!0})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Numéro SIRET",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(M,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"text",name:"siretNumber",className:"w-full pl-10 px-4 py-3 rounded-lg border border-gray-200 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent",placeholder:"123 456 789 00012",value:t.siretNumber,onChange:s,required:!0})]})]}),e.jsx("div",{className:"mt-6",children:e.jsx("button",{type:"submit",className:"w-full px-4 py-3 bg-gradient-to-r from-teal-600 to-blue-600 text-white rounded-lg hover:from-teal-700 hover:to-blue-700",disabled:h,children:h?"Chargement...":"Créer un compte"})}),e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-gray-200"})}),e.jsx("div",{className:"relative flex justify-center text-sm",children:e.jsx("span",{className:"px-2 bg-white text-gray-500",children:"Ou"})})]}),e.jsx("div",{className:"mt-6",children:e.jsx(I,{width:"100%",size:"large",text:"signup_with",shape:"rectangular",onSuccess:j,onError:b})})]}),e.jsx("div",{className:"mt-4 text-center",children:e.jsxs("p",{className:"text-sm text-gray-600",children:["Vous avez déjà un compte ?"," ",e.jsx("button",{type:"button",onClick:N,className:"text-teal-600 hover:underline font-medium",children:"Se connecter"})]})})]})},Z=({onCancel:v})=>{const[N,j]=r.useState(!1),[b,i]=r.useState(""),[m,h]=r.useState(""),[u,a]=r.useState({email:""}),n=x=>{const{name:s,value:g}=x.target;a({...u,[s]:g})},t=async x=>{var s,g,f,c,l,p,o;x.preventDefault(),i(""),h("");try{if(j(!0),!u.email){i("Veuillez renseigner votre adresse email.");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(u.email)){i("Veuillez saisir une adresse email valide.");return}await F.forgotPassword(u),h("Un email de réinitialisation a été envoyé à votre adresse. Veuillez vérifier votre boîte de réception et vos spams. Le lien est valable pendant 1 heure."),a({email:""})}catch(d){console.error("Erreur détaillée:",{message:d.message,response:d.response,status:(s=d.response)==null?void 0:s.status,data:(g=d.response)==null?void 0:g.data}),((f=d.response)==null?void 0:f.status)===404?i("Aucun compte n'est associé à cette adresse email. Veuillez vérifier votre saisie ou créer un compte."):((c=d.response)==null?void 0:c.status)===400?i("Veuillez vérifier votre adresse email."):((l=d.response)==null?void 0:l.status)===429?i("Trop de tentatives. Veuillez patienter quelques minutes avant de réessayer."):i(((o=(p=d.response)==null?void 0:p.data)==null?void 0:o.message)||"Une erreur est survenue. Veuillez réessayer plus tard.")}finally{j(!1)}};return e.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-50 bg-black bg-opacity-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-8 max-w-md mx-4 w-full",children:[e.jsx("h2",{className:"text-xl font-bold mb-4 text-teal-600",children:"Mot de passe oublié"}),e.jsx("p",{className:"text-gray-700 mb-4",children:"Veuillez saisir votre adresse email. Vous recevrez un lien pour créer un nouveau mot de passe. Ce lien sera valable pendant 1 heure."}),b&&e.jsx("div",{className:"p-3 bg-red-100 border border-red-200 rounded-md text-red-600 text-sm mb-4",children:b}),m&&e.jsx("div",{className:"p-3 bg-green-100 border border-green-200 rounded-md text-green-600 text-sm mb-4",children:m}),e.jsxs("form",{onSubmit:t,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Adresse email",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(P,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"email",name:"email",className:"w-full pl-10 px-4 py-3 rounded-lg border border-gray-200 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent",placeholder:"votreemail@exemple.com",value:u.email,onChange:n,required:!0})]})]}),e.jsxs("div",{className:"flex gap-4 mt-6",children:[e.jsx("button",{type:"button",onClick:v,className:"flex-1 px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300",children:"Annuler"}),e.jsx("button",{type:"submit",className:"flex-1 px-4 py-2 bg-gradient-to-r from-teal-600 to-blue-600 text-white rounded-lg hover:from-teal-700 hover:to-blue-700",disabled:N,children:N?"Chargement...":"Envoyer"})]})]})]})})},ee=({googleCredential:v,onCancel:N,inCart:j=!1})=>{const b=k(),{login:i}=z(),[m,h]=r.useState(!1),[u,a]=r.useState(""),[n,t]=r.useState({phoneNumber:"",companyName:"",siretNumber:""}),x=async s=>{var g,f,c,l,p;s.preventDefault(),a("");try{if(h(!0),!v)throw new Error("Session Google expirée. Veuillez réessayer.");const o=await F.registerWithGoogle(v,n);i(o),j?setTimeout(()=>{b("/panier/delivery")},2e3):setTimeout(()=>{b("/inscription-reussie")},1e3)}catch(o){console.error("Erreur d'inscription Google:",o),(c=(f=(g=o.response)==null?void 0:g.data)==null?void 0:f.message)!=null&&c.includes("téléphone")?a("Le format du numéro de téléphone n'est pas valide. Utilisez le format +33XXXXXXXXX."):a(((p=(l=o.response)==null?void 0:l.data)==null?void 0:p.message)||"Une erreur est survenue lors de l'inscription.")}finally{h(!1)}};return e.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-50 bg-black bg-opacity-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-8 max-w-md mx-4 w-full",children:[e.jsx("h2",{className:"text-xl font-bold mb-4 text-teal-600",children:"Informations supplémentaires requises"}),e.jsx("p",{className:"text-gray-700 mb-4",children:"Pour finaliser votre inscription, veuillez fournir les informations suivantes :"}),u&&e.jsx("div",{className:"p-3 bg-red-100 border border-red-200 rounded-md text-red-600 text-sm mb-4",children:u}),e.jsxs("form",{onSubmit:x,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Numéro de téléphone",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(U,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"tel",className:"w-full pl-10 px-4 py-3 rounded-lg border border-gray-200 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent",placeholder:"06 12 34 56 78",value:n.phoneNumber,onChange:s=>t({...n,phoneNumber:s.target.value}),required:!0})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Nom de l'entreprise",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(T,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"text",className:"w-full pl-10 px-4 py-3 rounded-lg border border-gray-200 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent",placeholder:"Distritherm Services",value:n.companyName,onChange:s=>t({...n,companyName:s.target.value}),required:!0})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Numéro SIRET",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(M,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"text",className:"w-full pl-10 px-4 py-3 rounded-lg border border-gray-200 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent",placeholder:"123 456 789 00012",value:n.siretNumber,onChange:s=>t({...n,siretNumber:s.target.value}),required:!0})]})]}),e.jsxs("div",{className:"flex gap-4 mt-6",children:[e.jsx("button",{type:"button",onClick:N,className:"flex-1 px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300",children:"Annuler"}),e.jsx("button",{type:"submit",className:"flex-1 px-4 py-2 bg-gradient-to-r from-teal-600 to-blue-600 text-white rounded-lg hover:from-teal-700 hover:to-blue-700",disabled:m,children:m?"Chargement...":"S'inscrire"})]})]})]})})},ae=({inCart:v=!1})=>{const N=k(),{isAuthenticated:j,error:b,clearError:i}=z(),[m,h]=r.useState(!0),[u,a]=r.useState(""),[n,t]=r.useState(null),[x,s]=r.useState(null),[g,f]=r.useState(!1),[c,l]=r.useState(!1),[p,o]=r.useState(!1),[d,y]=r.useState(null),[C,w]=r.useState("");r.useEffect(()=>{j&&N("/")},[j,N]),r.useEffect(()=>{b&&(a(b),i())},[b,i]),r.useEffect(()=>{const S=new URLSearchParams(window.location.search).get("token");S&&(w(S),o(!0),window.history.replaceState({},document.title,window.location.pathname))},[]);const R=async E=>{var S,D,G;try{if(a(""),!E.credential)throw new Error("Aucun credential Google reçu");s(E.credential),await F.loginWithGoogle(E.credential)}catch(L){console.error("Erreur Google Login:",L),((S=L.response)==null?void 0:S.status)===404?f(!0):a(((G=(D=L.response)==null?void 0:D.data)==null?void 0:G.message)||"Une erreur est survenue lors de la connexion avec Google.")}},X=()=>{a("La connexion avec Google a échoué. Veuillez réessayer ou utiliser le formulaire de connexion classique.")},q=()=>{h(!m),a("")},B=()=>{l(!0),a("")},O=()=>{l(!1),a("")},W=()=>{o(!1),h(!0)},_=()=>{o(!1),h(!0)},$=()=>{f(!1),s(null),a("")},J=()=>e.jsx("section",{className:`relative ${v?"py-4":"py-20"} overflow-hidden`,children:e.jsx("div",{className:"container mx-auto px-4",children:e.jsx("div",{className:"max-w-xl mx-auto",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-8",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:m?"Connexion":"Inscription"}),e.jsx("p",{className:"text-gray-600",children:m?"Connectez-vous à votre compte pour continuer":"Créez un compte pour accéder à tous nos services"})]}),m?e.jsx(Q,{inCart:v,onSwitchForm:q,onShowForgotPassword:B,onGoogleSuccess:R,onGoogleError:X}):e.jsx(Y,{inCart:v,onSwitchForm:q,onGoogleSuccess:R,onGoogleError:X})]})})})});return e.jsxs(K,{children:[g&&x&&e.jsx(ee,{googleCredential:x,onCancel:$,inCart:v}),c&&e.jsx(Z,{onCancel:O}),p&&e.jsx(H,{token:C,onCancel:_,onSuccess:W}),J()]})};export{ae as default};
