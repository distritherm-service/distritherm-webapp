import{a4 as J,D as Q,r as x,j as e,aa as z,ab as X,a7 as B,B as Y,A as Z,z as _,a8 as ee,ac as se,a3 as v,a6 as P}from"./index-lICg0_8z.js";import{L as re}from"./Layout-CEXniyLP.js";import"./Slider-BphwLHNT.js";import"./Breadcrumb-xcL7W6ju.js";const oe=()=>{var V;const{user:s,isAuthenticated:C,updateUser:S}=J(),k=Q(),[r,N]=x.useState({firstName:"",lastName:"",email:"",phoneNumber:"",companyName:"",siretNumber:""}),[d,E]=x.useState({currentPassword:"",newPassword:"",confirmPassword:""}),[a,g]=x.useState(!1),[b,p]=x.useState(!1),[F,t]=x.useState(""),[D,u]=x.useState(""),[y,H]=x.useState("informations");x.useEffect(()=>{C?s&&N({firstName:s.firstName||"",lastName:s.lastName||"",email:s.email||"",phoneNumber:s.phoneNumber||"",companyName:s.companyName||"",siretNumber:s.siretNumber||""}):k("/connexion")},[C,k,s]);const h=n=>{const{name:l,value:i}=n.target;if(l==="siretNumber"){const f=i.replace(/\D/g,"").slice(0,14);N(j=>({...j,[l]:f}))}else N(c=>({...c,[l]:i}))},w=n=>{const{name:l,value:i}=n.target;E(c=>({...c,[l]:i}))},O=()=>r.siretNumber&&r.siretNumber.replace(/\D/g,"").length!==14?(t("Le numéro SIRET doit contenir exactement 14 chiffres."),!1):!0,W=async n=>{var l,i,c,f,j,I,M,A,R,U,$,T;if(n.preventDefault(),p(!0),t(""),u(""),!O()){p(!1);return}try{const m={firstName:r.firstName,lastName:r.lastName,phoneNumber:r.phoneNumber,companyName:r.companyName,siretNumber:r.siretNumber.replace(/\D/g,"")};console.log("Envoi des données de mise à jour:",m);const o=await P.updateProfile(m);if(console.log("Réponse complète de mise à jour du profil:",o),console.log("Structure de la réponse:",Object.keys(o)),o.user)console.log("Données utilisateur reçues:",o.user),S(o.user),u("Votre profil a été mis à jour avec succès."),g(!1);else{console.log("Aucune donnée utilisateur dans la réponse");const q=P.getCurrentUser();if(q){const G={...q,firstName:r.firstName,lastName:r.lastName,phoneNumber:r.phoneNumber,companyName:r.companyName,siretNumber:r.siretNumber};S(G),u("Votre profil a été mis à jour avec succès."),g(!1)}}}catch(m){console.error("Erreur de mise à jour du profil:",m);let o="Une erreur est survenue lors de la mise à jour du profil.";((l=m.response)==null?void 0:l.status)===400&&((f=(c=(i=m.response)==null?void 0:i.data)==null?void 0:c.message)!=null&&f.includes("téléphone")?o="Le format du numéro de téléphone n'est pas valide.":(M=(I=(j=m.response)==null?void 0:j.data)==null?void 0:I.message)!=null&&M.includes("SIRET")||(U=(R=(A=m.response)==null?void 0:A.data)==null?void 0:R.message)!=null&&U.includes("numeric")?o="Le format du numéro SIRET n'est pas valide. Il doit contenir exactement 14 chiffres.":o=((T=($=m.response)==null?void 0:$.data)==null?void 0:T.message)||o),t(o)}finally{p(!1)}},K=async n=>{var l,i,c;if(n.preventDefault(),p(!0),t(""),u(""),d.newPassword!==d.confirmPassword){t("Les nouveaux mots de passe ne correspondent pas."),p(!1);return}if(d.newPassword.length<8){t("Le nouveau mot de passe doit comporter au moins 8 caractères."),p(!1);return}try{await P.updatePassword(d.currentPassword,d.newPassword),u("Votre mot de passe a été mis à jour avec succès."),E({currentPassword:"",newPassword:"",confirmPassword:""})}catch(f){((l=f.response)==null?void 0:l.status)===401?t("Le mot de passe actuel est incorrect."):t(((c=(i=f.response)==null?void 0:i.data)==null?void 0:c.message)||"Une erreur est survenue lors de la mise à jour du mot de passe.")}finally{p(!1)}},L=n=>{H(n),t(""),u(""),n==="informations"&&g(!1)};return e.jsx(re,{children:e.jsx("div",{className:"container mx-auto px-4 py-12",children:e.jsxs("div",{className:"max-w-3xl mx-auto bg-white rounded-lg shadow-lg overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-teal-500 to-blue-500 px-6 py-4",children:e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Mon Profil"})}),e.jsxs("div",{className:"flex border-b",children:[e.jsxs("button",{className:`flex items-center px-6 py-4 text-sm font-medium ${y==="informations"?"border-b-2 border-teal-500 text-teal-600":"text-gray-500 hover:text-gray-700"}`,onClick:()=>L("informations"),children:[e.jsx(z,{className:"mr-2"}),"Informations personnelles"]}),s&&s.type!=="PROVIDER"&&e.jsxs("button",{className:`flex items-center px-6 py-4 text-sm font-medium ${y==="motDePasse"?"border-b-2 border-teal-500 text-teal-600":"text-gray-500 hover:text-gray-700"}`,onClick:()=>L("motDePasse"),children:[e.jsx(X,{className:"mr-2"}),"Changer de mot de passe"]})]}),e.jsxs("div",{className:"p-6",children:[F&&e.jsx("div",{className:"mb-4 bg-red-100 border-l-4 border-red-500 text-red-700 p-4 rounded",children:e.jsx("p",{children:F})}),D&&e.jsx("div",{className:"mb-4 bg-green-100 border-l-4 border-green-500 text-green-700 p-4 rounded",children:e.jsx("p",{children:D})}),y==="informations"&&e.jsxs("form",{onSubmit:W,children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Prénom"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(B,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"text",name:"firstName",value:r.firstName,onChange:h,disabled:!a,className:`w-full pl-10 px-4 py-3 rounded-lg border ${a?"border-gray-200 bg-white focus:ring-2 focus:ring-teal-500 focus:border-transparent":"border-gray-200 bg-gray-100 cursor-not-allowed"}`,placeholder:"Prénom"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nom"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(B,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"text",name:"lastName",value:r.lastName,onChange:h,disabled:!a,className:`w-full pl-10 px-4 py-3 rounded-lg border ${a?"border-gray-200 bg-white focus:ring-2 focus:ring-teal-500 focus:border-transparent":"border-gray-200 bg-gray-100 cursor-not-allowed"}`,placeholder:"Nom"})]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Adresse e-mail"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(Y,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"email",name:"email",value:r.email,disabled:!0,className:"w-full pl-10 px-4 py-3 rounded-lg border border-gray-200 bg-gray-100 cursor-not-allowed",placeholder:"Email"})]}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"L'adresse e-mail ne peut pas être modifiée."}),s&&!((V=s==null?void 0:s.client)!=null&&V.emailVerified)&&e.jsx("div",{className:"mt-2 p-3 bg-yellow-50 border border-yellow-200 rounded-md",children:e.jsxs("p",{className:"text-sm text-yellow-700 flex items-center",children:[e.jsx("span",{className:"mr-2",children:"⚠️"}),"Votre email n'est pas vérifié. Veuillez vérifier votre boîte de réception et cliquer sur le lien de vérification."]})})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Numéro de téléphone"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(Z,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"tel",name:"phoneNumber",value:r.phoneNumber,onChange:h,disabled:!a,className:`w-full pl-10 px-4 py-3 rounded-lg border ${a?"border-gray-200 bg-white focus:ring-2 focus:ring-teal-500 focus:border-transparent":"border-gray-200 bg-gray-100 cursor-not-allowed"}`,placeholder:"06 12 34 56 78"})]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Format: 06 12 34 56 78 (sera automatiquement converti au format international)"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nom de l'entreprise"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(_,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"text",name:"companyName",value:r.companyName,onChange:h,disabled:!a,className:`w-full pl-10 px-4 py-3 rounded-lg border ${a?"border-gray-200 bg-white focus:ring-2 focus:ring-teal-500 focus:border-transparent":"border-gray-200 bg-gray-100 cursor-not-allowed"}`,placeholder:"Nom de l'entreprise"})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Numéro SIRET"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(ee,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"text",name:"siretNumber",value:r.siretNumber,onChange:h,disabled:!a,pattern:"[0-9]*",inputMode:"numeric",className:`w-full pl-10 px-4 py-3 rounded-lg border ${a?"border-gray-200 bg-white focus:ring-2 focus:ring-teal-500 focus:border-transparent":"border-gray-200 bg-gray-100 cursor-not-allowed"}`,placeholder:"12345678901234"})]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Format: 14 chiffres uniquement, sans espaces ni caractères spéciaux"})]}),e.jsx("div",{className:"mt-8 flex justify-end space-x-4",children:a?e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",onClick:()=>{g(!1),s&&N({firstName:s.firstName||"",lastName:s.lastName||"",email:s.email||"",phoneNumber:s.phoneNumber||"",companyName:s.companyName||"",siretNumber:s.siretNumber||""}),t(""),u("")},className:"px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:"Annuler"}),e.jsx("button",{type:"submit",disabled:b,className:`flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white ${b?"bg-teal-400 cursor-not-allowed":"bg-teal-600 hover:bg-teal-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-teal-500"}`,children:b?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Enregistrement..."]}):e.jsxs(e.Fragment,{children:[e.jsx(se,{className:"mr-2"}),"Enregistrer"]})})]}):e.jsxs("button",{type:"button",onClick:()=>{g(!0),t(""),u("")},className:"flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-teal-600 hover:bg-teal-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-teal-500",children:[e.jsx(z,{className:"mr-2"}),"Modifier"]})})]}),y==="motDePasse"&&e.jsx("form",{onSubmit:K,className:"mt-4",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Mot de passe actuel",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(v,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"password",name:"currentPassword",value:d.currentPassword,onChange:w,required:!0,className:"w-full pl-10 px-4 py-3 rounded-lg border border-gray-200 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent",placeholder:"********"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Nouveau mot de passe",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(v,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"password",name:"newPassword",value:d.newPassword,onChange:w,required:!0,minLength:8,className:"w-full pl-10 px-4 py-3 rounded-lg border border-gray-200 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent",placeholder:"********"})]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Le mot de passe doit contenir au moins 8 caractères."})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Confirmer le nouveau mot de passe",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(v,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"password",name:"confirmPassword",value:d.confirmPassword,onChange:w,required:!0,className:"w-full pl-10 px-4 py-3 rounded-lg border border-gray-200 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent",placeholder:"********"})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{type:"submit",disabled:b,className:"flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-teal-600 hover:bg-teal-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-teal-500",children:b?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Enregistrement..."]}):e.jsxs(e.Fragment,{children:[e.jsx(v,{className:"mr-2"}),"Changer le mot de passe"]})})})]})})]})]})})})};export{oe as default};
