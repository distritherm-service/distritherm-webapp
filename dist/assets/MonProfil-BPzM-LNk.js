import{a9 as _,u as ee,r as u,j as e,L as q,af as se,ag as H,ah as re,ac as W,K,J as ae,I as te,ad as ne,ai as le,a8 as y,ab as C}from"./index-CDkvhUR-.js";import{L as oe}from"./Layout-Cl8seCFz.js";import"./Slider-0voPl_dV.js";const de=()=>{var D,M;const{user:s,isAuthenticated:P,updateUser:k,logout:O}=_(),w=ee(),[r,N]=u.useState({firstName:"",lastName:"",email:"",phoneNumber:"",companyName:"",siretNumber:""}),[c,S]=u.useState({currentPassword:"",newPassword:"",confirmPassword:""}),[n,f]=u.useState(!1),[g,x]=u.useState(!1),[E,l]=u.useState(""),[L,m]=u.useState(""),[j,G]=u.useState("informations");u.useEffect(()=>{var a,t;P?s&&N({firstName:s.firstName||"",lastName:s.lastName||"",email:s.email||"",phoneNumber:s.phoneNumber||"",companyName:s.companyName||((a=s.client)==null?void 0:a.companyName)||"",siretNumber:s.siretNumber||((t=s.client)==null?void 0:t.siretNumber)||""}):w("/connexion")},[P,w,s]);const b=a=>{const{name:t,value:o}=a.target;if(t==="siretNumber"){const p=o.replace(/\D/g,"").slice(0,14);N(v=>({...v,[t]:p}))}else N(i=>({...i,[t]:o}))},F=a=>{const{name:t,value:o}=a.target;S(i=>({...i,[t]:o}))},J=()=>r.siretNumber&&r.siretNumber.replace(/\D/g,"").length!==14?(l("Le numéro SIRET doit contenir exactement 14 chiffres."),!1):!0,Q=async a=>{var t,o,i,p,v,U,I,B,$,A,z,R;if(a.preventDefault(),x(!0),l(""),m(""),!J()){x(!1);return}try{const h={firstName:r.firstName,lastName:r.lastName,phoneNumber:r.phoneNumber,companyName:r.companyName,siretNumber:r.siretNumber.replace(/\D/g,"")},d=await C.updateProfile(h);if(d.user)k(d.user),m("Votre profil a été mis à jour avec succès."),f(!1);else{const T=C.getCurrentUser();if(T){const Z={...T,firstName:r.firstName,lastName:r.lastName,phoneNumber:r.phoneNumber,companyName:r.companyName,siretNumber:r.siretNumber};k(Z),m("Votre profil a été mis à jour avec succès."),f(!1)}}}catch(h){let d="Une erreur est survenue lors de la mise à jour du profil.";((t=h.response)==null?void 0:t.status)===400&&((p=(i=(o=h.response)==null?void 0:o.data)==null?void 0:i.message)!=null&&p.includes("téléphone")?d="Le format du numéro de téléphone n'est pas valide.":(I=(U=(v=h.response)==null?void 0:v.data)==null?void 0:U.message)!=null&&I.includes("SIRET")||(A=($=(B=h.response)==null?void 0:B.data)==null?void 0:$.message)!=null&&A.includes("numeric")?d="Le format du numéro SIRET n'est pas valide. Il doit contenir exactement 14 chiffres.":d=((R=(z=h.response)==null?void 0:z.data)==null?void 0:R.message)||d),l(d)}finally{x(!1)}},X=async a=>{var t,o,i;if(a.preventDefault(),x(!0),l(""),m(""),c.newPassword!==c.confirmPassword){l("Les nouveaux mots de passe ne correspondent pas."),x(!1);return}if(c.newPassword.length<8){l("Le nouveau mot de passe doit comporter au moins 8 caractères."),x(!1);return}try{await C.updatePassword(c.currentPassword,c.newPassword),m("Votre mot de passe a été mis à jour avec succès."),S({currentPassword:"",newPassword:"",confirmPassword:""})}catch(p){((t=p.response)==null?void 0:t.status)===401?l("Le mot de passe actuel est incorrect."):l(((i=(o=p.response)==null?void 0:o.data)==null?void 0:i.message)||"Une erreur est survenue lors de la mise à jour du mot de passe.")}finally{x(!1)}},V=a=>{G(a),l(""),m(""),a==="informations"&&f(!1)},Y=()=>s!=null&&s.firstName&&s.lastName?`${s.firstName} ${s.lastName}`:s!=null&&s.firstName?s.firstName:s!=null&&s.lastName?s.lastName:(s==null?void 0:s.email)||"Utilisateur";return e.jsx(oe,{children:e.jsx("div",{className:"container mx-auto px-4 py-12",children:e.jsxs("div",{className:"max-w-5xl mx-auto",children:[e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg overflow-hidden mb-6",children:[e.jsx("div",{className:"bg-gradient-to-r from-[#7CB9E8] to-[#007FFF] px-6 py-8",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-16 h-16 bg-white rounded-full flex items-center justify-center shadow-md",children:e.jsx("span",{className:"text-2xl font-bold text-[#007FFF]",children:s!=null&&s.firstName?s.firstName[0].toUpperCase():(D=s==null?void 0:s.email)==null?void 0:D[0].toUpperCase()})}),e.jsxs("div",{className:"ml-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:Y()}),e.jsx("p",{className:"text-[#FFFFFF]/90",children:s==null?void 0:s.email})]})]})}),e.jsxs("div",{className:"p-6 grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs(q,{to:"/mes-commandes",className:"flex items-center p-4 bg-white border border-gray-200 rounded-xl hover:border-[#007FFF] transition-colors group",children:[e.jsx("div",{className:"w-12 h-12 bg-[#7CB9E8]/20 rounded-lg flex items-center justify-center group-hover:bg-[#007FFF] transition-colors",children:e.jsx("svg",{className:"w-6 h-6 text-[#007FFF] group-hover:text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"})})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"Mes commandes"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Suivre mes commandes"})]})]}),e.jsxs(q,{to:"/mes-devis",className:"flex items-center p-4 bg-white border border-gray-200 rounded-xl hover:border-[#007FFF] transition-colors group",children:[e.jsx("div",{className:"w-12 h-12 bg-[#7CB9E8]/20 rounded-lg flex items-center justify-center group-hover:bg-[#007FFF] transition-colors",children:e.jsx("svg",{className:"w-6 h-6 text-[#007FFF] group-hover:text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"Mes devis"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Gérer mes devis"})]})]}),e.jsxs("button",{onClick:O,className:"flex items-center p-4 bg-white border border-gray-200 rounded-xl hover:border-red-500 transition-colors group",children:[e.jsx("div",{className:"w-12 h-12 bg-red-100 rounded-lg flex items-center justify-center group-hover:bg-red-500 transition-colors",children:e.jsx(se,{className:"w-6 h-6 text-red-600 group-hover:text-white"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"Déconnexion"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Se déconnecter"})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-[#7CB9E8] to-[#007FFF] px-6 py-4",children:e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Mon Profil"})}),e.jsxs("div",{className:"flex border-b",children:[e.jsxs("button",{className:`flex items-center px-6 py-4 text-sm font-medium ${j==="informations"?"border-b-2 border-[#007FFF] text-[#007FFF]":"text-gray-500 hover:text-gray-700"}`,onClick:()=>V("informations"),children:[e.jsx(H,{className:"mr-2"}),"Informations personnelles"]}),s&&s.type!=="PROVIDER"&&e.jsxs("button",{className:`flex items-center px-6 py-4 text-sm font-medium ${j==="motDePasse"?"border-b-2 border-[#007FFF] text-[#007FFF]":"text-gray-500 hover:text-gray-700"}`,onClick:()=>V("motDePasse"),children:[e.jsx(re,{className:"mr-2"}),"Changer de mot de passe"]})]}),e.jsxs("div",{className:"p-6",children:[E&&e.jsx("div",{className:"mb-4 bg-red-100 border-l-4 border-red-500 text-red-700 p-4 rounded",children:e.jsx("p",{children:E})}),L&&e.jsx("div",{className:"mb-4 bg-green-100 border-l-4 border-green-500 text-green-700 p-4 rounded",children:e.jsx("p",{children:L})}),j==="informations"&&e.jsxs("form",{onSubmit:Q,children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Prénom"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(W,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"text",name:"firstName",value:r.firstName,onChange:b,disabled:!n,className:`w-full pl-10 px-4 py-3 rounded-lg border ${n?"border-gray-200 bg-white focus:ring-2 focus:ring-blue-500 focus:border-transparent":"border-gray-200 bg-gray-100 cursor-not-allowed"}`,placeholder:"Prénom"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nom"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(W,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"text",name:"lastName",value:r.lastName,onChange:b,disabled:!n,className:`w-full pl-10 px-4 py-3 rounded-lg border ${n?"border-gray-200 bg-white focus:ring-2 focus:ring-blue-500 focus:border-transparent":"border-gray-200 bg-gray-100 cursor-not-allowed"}`,placeholder:"Nom"})]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Adresse e-mail"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(K,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"email",name:"email",value:r.email,disabled:!0,className:"w-full pl-10 px-4 py-3 rounded-lg border border-gray-200 bg-gray-100 cursor-not-allowed",placeholder:"Email"})]}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"L'adresse e-mail ne peut pas être modifiée."}),s&&!((M=s==null?void 0:s.client)!=null&&M.emailVerified)&&e.jsxs("div",{className:"mt-2 p-3 bg-yellow-50 border border-yellow-200 rounded-md",children:[e.jsxs("p",{className:"text-sm text-yellow-700 flex items-center",children:[e.jsx("span",{className:"mr-2",children:"⚠️"}),"Votre email n'est pas vérifié. Veuillez vérifier votre boîte de réception et cliquer sur le lien de vérification."]}),e.jsxs("button",{onClick:()=>w("/verification-email"),className:"mt-2 inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-yellow-600 hover:bg-yellow-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-yellow-500",children:[e.jsx(K,{className:"mr-2"}),"Vérifier mon email"]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Numéro de téléphone"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(ae,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"tel",name:"phoneNumber",value:r.phoneNumber,onChange:b,disabled:!n,className:`w-full pl-10 px-4 py-3 rounded-lg border ${n?"border-gray-200 bg-white focus:ring-2 focus:ring-blue-500 focus:border-transparent":"border-gray-200 bg-gray-100 cursor-not-allowed"}`,placeholder:"06 12 34 56 78"})]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Format: 06 12 34 56 78 (sera automatiquement converti au format international)"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nom de l'entreprise"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(te,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"text",name:"companyName",value:r.companyName,onChange:b,disabled:!n,className:`w-full pl-10 px-4 py-3 rounded-lg border ${n?"border-gray-200 bg-white focus:ring-2 focus:ring-blue-500 focus:border-transparent":"border-gray-200 bg-gray-100 cursor-not-allowed"}`,placeholder:"Nom de l'entreprise"})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Numéro SIRET"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(ne,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"text",name:"siretNumber",value:r.siretNumber,onChange:b,disabled:!n,pattern:"[0-9]*",inputMode:"numeric",className:`w-full pl-10 px-4 py-3 rounded-lg border ${n?"border-gray-200 bg-white focus:ring-2 focus:ring-blue-500 focus:border-transparent":"border-gray-200 bg-gray-100 cursor-not-allowed"}`,placeholder:"12345678901234"})]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Format: 14 chiffres uniquement, sans espaces ni caractères spéciaux"})]}),e.jsx("div",{className:"mt-8 flex justify-end space-x-4",children:n?e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",onClick:()=>{f(!1),s&&N({firstName:s.firstName||"",lastName:s.lastName||"",email:s.email||"",phoneNumber:s.phoneNumber||"",companyName:s.companyName||"",siretNumber:s.siretNumber||""}),l(""),m("")},className:"px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:"Annuler"}),e.jsx("button",{type:"submit",disabled:g,className:`flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white ${g?"bg-[#7CB9E8] cursor-not-allowed":"bg-[#007FFF] hover:bg-[#0066CC] focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#007FFF]"}`,children:g?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Enregistrement..."]}):e.jsxs(e.Fragment,{children:[e.jsx(le,{className:"mr-2"}),"Enregistrer"]})})]}):e.jsxs("button",{type:"button",onClick:()=>{f(!0),l(""),m("")},className:"flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[e.jsx(H,{className:"mr-2"}),"Modifier"]})})]}),j==="motDePasse"&&e.jsx("form",{onSubmit:X,className:"mt-4",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Mot de passe actuel",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(y,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"password",name:"currentPassword",value:c.currentPassword,onChange:F,required:!0,className:"w-full pl-10 px-4 py-3 rounded-lg border border-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"********"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Nouveau mot de passe",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(y,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"password",name:"newPassword",value:c.newPassword,onChange:F,required:!0,minLength:8,className:"w-full pl-10 px-4 py-3 rounded-lg border border-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"********"})]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Le mot de passe doit contenir au moins 8 caractères."})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Confirmer le nouveau mot de passe",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(y,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"password",name:"confirmPassword",value:c.confirmPassword,onChange:F,required:!0,className:"w-full pl-10 px-4 py-3 rounded-lg border border-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"********"})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{type:"submit",disabled:g,className:"flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:g?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Enregistrement..."]}):e.jsxs(e.Fragment,{children:[e.jsx(y,{className:"mr-2"}),"Changer le mot de passe"]})})})]})})]})]})]})})})};export{de as default};
